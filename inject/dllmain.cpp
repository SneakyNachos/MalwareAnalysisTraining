#include <stdafx.h>
#include <iostream>
#include <windows.h>
#include <stdlib.h>
#include <tlhelp32.h>
#include <tchar.h>
#include <string>
#include <shlwapi.h>
#include <string>
using namespace std;
BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_called, LPVOID reserved) {
	FILE *file;
	CHAR buf[MAX_PATH + 1];
	fopen_s(&file, "C:\\temp.txt", "a+");
	GetModuleFileNameA(NULL, buf, MAX_PATH + 1);
	string s(buf);
	s.append("\n");
	if (file == INVALID_HANDLE_VALUE) {
		return TRUE;
	}
	switch (ul_reason_for_called) {
	case DLL_PROCESS_ATTACH:
		fprintf(file, "Process attach\n");
		fprintf(file, s.c_str());
		break;
	case DLL_PROCESS_DETACH:
		fprintf(file, "Process detach\n");
		fprintf(file, s.c_str());
		break;
	case DLL_THREAD_DETACH:
		//fprintf(file, "Thread detach\n");
		break;
	case DLL_THREAD_ATTACH:
		//fprintf(file, "Thread attach\n");
		break;
	}
	fclose(file);
	return TRUE;
}



